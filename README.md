# FunctionPlotter - 函数曲线绘制与Modbus数据监控工具

<div align="center">

![Python Version](https://img.shields.io/badge/python-3.8+-blue.svg)
![License](https://img.shields.io/badge/license-MIT-green.svg)
![Platform](https://img.shields.io/badge/platform-Windows-0078D4.svg)

**一个基于 PyQt6 的专业工具，集成数学函数曲线绘制与工业Modbus设备实时监控**

[📖 中文使用说明](使用说明.md) | [🐍 Python代码](function_plotter.py)

</div>

---

## 🎯 核心功能

### 📊 函数曲线绘制
- ✅ 支持常见数学函数表达式
- ✅ 自定义函数库管理（添加、使用、删除）
- ✅ 灵活的参数配置（x轴范围、采样点数）
- ✅ 丰富的样式设置（颜色、线型、线宽）
- ✅ 快速函数按钮（sin/cos/tan/exp/log/sqrt等）
- ✅ 鼠标悬停数据提示
- ✅ 图表缩放、平移、保存

### 🔌 Modbus 实时监控
- ✅ 支持 Modbus TCP 和 RTU 双模式
- ✅ 多通道数据采集（最多10个通道）
- ✅ 寄存器配置管理（增删改）
- ✅ 实时曲线可视化
- ✅ 自动搜索串口设备
- ✅ SQLite 数据库存储
- ✅ CSV 数据导出
- ✅ 通道独立颜色配置

### 📈 历史数据分析
- ✅ 时间范围查询
- ✅ 从站ID/地址筛选
- ✅ 数据表格展示
- ✅ 历史曲线可视化
- ✅ 批量数据导出
- ✅ 数据删除管理

---

## 🚀 快速开始

### 环境要求

```
操作系统: Windows 10/11 (64位)
Python版本: 3.8 或更高版本
依赖库: Visual C++ Redistributable (通常系统已预装)
```

### 安装步骤

1. **克隆或下载项目**
   ```bash
   git clone https://github.com/anjee2024/function-plotter.git
   cd function-plotter
   ```

2. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

3. **运行程序**
   ```bash
   python function_plotter.py
   ```

---

## 📖 功能模块详解

### 1️⃣ 函数曲线绘制

#### 快速上手
1. 切换到"函数曲线"标签页
2. 输入数学表达式（如 `sin(x)`、`x**2`）
3. 设置x轴范围
4. 点击"绘制曲线"

#### 支持的数学函数
- **三角函数**: sin, cos, tan, asin, acos, atan
- **双曲函数**: sinh, cosh, tanh  
- **指数对数**: exp, log, log10, log2
- **其他函数**: sqrt, abs, pow
- **常数**: pi, e

#### 自定义函数库
- 添加常用函数表达式
- 一键快速使用
- 支持函数描述

---

### 2️⃣ Modbus 实时监控

#### 连接设备

**TCP模式:**
- 主机地址: `192.168.1.100`
- 端口: `502` (默认)

**RTU模式:**
- 点击"搜索"自动查找串口
- 选择串口（如 COM3）
- 设置波特率/数据位/停止位/校验位

#### 多通道配置

**添加通道:**
1. 点击"添加通道"按钮
2. 填写通道信息：
   - 通道名称（如"温度传感器"）
   - 从站ID（1-247）
   - 寄存器地址
   - 功能码（03/04/01/02）
   - 单位（可选）
   - 缩放比例（默认1.0）
   - 偏移量（默认0.0）
   - 曲线颜色
3. 点击"确定"

**采集控制:**
- 设置采集间隔（建议≥100ms）
- 勾选"保存到数据库"
- 点击"开始采集"

---

### 3️⃣ 历史数据分析

#### 查询流程
1. 切换到"历史数据"标签页
2. 设置查询时间范围
3. （可选）设置从站ID筛选
4. 点击"查询"按钮
5. 查看表格数据

#### 数据可视化
- 点击"显示曲线"生成图表
- 不同地址自动分配颜色
- 支持图表样式自定义

#### 数据导出
- 查询结果可导出为CSV
- 支持批量导出
- 兼容Excel等工具

---

## 🎛️ 用户界面

### 主窗口布局
```
┌─────────────────────────────────────────────────────────────┐
│  📊 函数曲线  🔌 实时监控  📈 历史数据  ⚙️ 实时曲线样式        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                      工作区                                  │
│                                                             │
│  - 左侧：参数配置和控制面板                                 │
│  - 右侧：图表显示和数据显示区域                             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 右键菜单功能
- **图表样式设置**: 颜色、线型、线宽、透明度
- **网格显示切换**: 显示/隐藏坐标网格
- **图例显示切换**: 显示/隐藏曲线图例
- **标记点设置**: 显示/隐藏数据点标记

---

## 💾 数据管理

### 数据库结构

程序自动生成 `modbus_data.db` SQLite数据库：

**modbus_data表** (历史数据)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER | 主键 |
| timestamp | TEXT | 时间戳 |
| slave_id | INTEGER | 从站ID |
| address | INTEGER | 寄存器地址 |
| function_code | INTEGER | 功能码 |
| value | REAL | 数值 |
| unit | TEXT | 单位 |

### 数据备份
1. 关闭程序
2. 复制 `modbus_data.db` 文件
3. 妥善保存备份文件

---

## 🔧 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| PyQt6 | 6.7.0 | GUI框架 |
| NumPy | 1.26.4 | 数值计算 |
| Matplotlib | 3.8.4 | 图表绘制 |
| pymodbus | 3.7.4 | Modbus协议 |
| pyserial | 3.5 | 串口通信 |
| SQLite3 | 内置 | 数据存储 |

---

## ⚠️ 注意事项

### 性能优化建议
1. **采集间隔**: ≥100ms（避免程序卡顿）
2. **存储间隔**: ≥5秒（减少数据库压力）
3. **通道数量**: ≤10个（保证实时性）
4. **定期清理**: 删除旧数据（控制数据库大小）

### 常见问题

**Q: 无法连接Modbus设备**
- 检查IP地址/端口或串口参数
- 确认从站ID正确
- 检查防火墙设置
- 使用Modbus调试工具验证设备

**Q: RTU模式找不到串口**
- 点击"搜索"按钮自动查找
- 检查设备管理器中的COM端口
- 确认驱动已正确安装

**Q: 曲线不显示**
- 检查Y轴范围设置
- 点击工具栏"自动缩放"
- 确认数据采集正常

**Q: 中文显示乱码**
- 确保系统已安装中文字体
- 程序已内置字体支持

---

## 📄 许可证

MIT License - 详见 LICENSE 文件

---

## 👤 作者

**anjee**

GitHub: [@anjee2024](https://github.com/anjee2024)

---

## 🙏 致谢

- PyQt6 社区
- Matplotlib 开发团队
- pymodbus 项目
- 所有开源贡献者

---

<div align="center">

**⭐ 如果这个项目对您有帮助，请给个 Star！**

</div>
